# 14 Elastic Beanstalk

A lot of web applications have the same architecture (ALB + ASG), this is where Elastic Beanstalk comes in.

**Elastic Beanstalk is a managed servie for deploying an application on AWS**:
- Automatically handles capacity provisioning, load balancing, scaling, application health monitoring, instance configuration, etc.
- The application code is the only responsibility of the developer.

You still have full control over the configuration and it is free, you only pay for the underlying instances.
- It supports pretty much anything: Go, Java, .NET, PHP, Node.js, Python, Ruby, single-container Docker, multi-container Docker, preconfigured Docker, etc.

## 14.1 Components

- **Application**: a collection of Elastic Beanstalk components (environments, versions, configurations, etc.).
- **Application Version**: an iteration of your application code.
- **Environment**:
    - A collection of AWS resources running an application version (only one application version at a time but it can be updated).
    - **Tiers**: **Web Server Environment Tier** and **Worker Environment Tier**.
    - You can create multiple environments (dev, test, prod, and so on).

## 14.2 Web Server Environment Tier vs Worker Environment Tier

In the **web server environment tier**, the environment runs an ELB that redirects traffic to the EC2 instances running a web server within an ASG.

![Web Server Environment Tier](/assets/aws-certified-developer-associate/eb_web_server_environment_tier.png "Web Server Environment Tier")

In the **worker environment tier**, the environment runs a SQS queue that is polled by the EC2 instances (the workers) within an ASG. In this case, scaling is based on the number of messages in the queue.

![Worker Environment Tier](/assets/aws-certified-developer-associate/eb_worker_environment_tier.png "Worker Environment Tier")

You **can combine both tiers**, for example, you can have a web server environment tier that sends messages to a worker environment tier.

## 14.3 Deployment Modes

### 14.3.1 Single Instance Deployment Mode

It is great for development environments because it is the cheapest and fastest way to deploy.

It comprises:
- An EC2 instance running the application.
- A RDS master database instance.
- An Elastic IP address.

![Single Instance Deployment](/assets/aws-certified-developer-associate/eb_single_instance_deployment.png "Single Instance Deployment")

### 14.3.2 High Availability with Load Balancer Deployment Mode

It is great for production environments because it is highly available and scalable.

It comprises:
- An ASG spanning multiple AZs with multiple EC2 instances running the application.
- An ALB that distributes the traffic to the EC2 instances.
- A RDS master database instance, optionally with multi-AZ configuration.

![High Availability with Load Balancer Deployment](/assets/aws-certified-developer-associate/eb_high_availability_with_load_balancer_deployment.png "High Availability with Load Balancer Deployment")

## 14.4 Creating an Elastic Beanstalk Environment

To create an environment, go to the Elastic Beanstalk console and click on **Create Application**.

Select the **environment tier** and enter a **name** for the application:

![Create Application](/assets/aws-certified-developer-associate/eb_create_application.png "Create Application")

Next are **environment information** like name and domain:

![Environment Information](/assets/aws-certified-developer-associate/eb_environment_information.png "Environment Information")

Then, you need to specify the **platform settings** (e.g., Node.js, Python, Ruby, etc.):

![Platform Settings](/assets/aws-certified-developer-associate/eb_platform_settings.png "Platform Settings")

After that, you need to provide the **application code** (you can also select to use a sample application) and the **presets**:

![Application Code](/assets/aws-certified-developer-associate/eb_application_code.png "Application Code")

Move on to the **service access** configuration. This contains all the IAM roles that are need to allow Elastic Beanstalk to work properly.

![Service Access](/assets/aws-certified-developer-associate/eb_service_access.png "Service Access")

All of the **other configurations** that you can see in the first image (networking, scaling, logs, etc.) are optional. So, you can skip them from the console and review the current environment configuration.

Finally, you can create the environment and see it in the console:

![Environment Created](/assets/aws-certified-developer-associate/eb_environment_created.png "Environment Created")

Under the *Events* tab in the created enviroment, you can see the events generated by CloudFormation, which is the service that is being used by Elastic Beanstalk to create the environment's resources. You can see such resources in the *Resources* tab or under the related services consoles, such as EC2 and ASG.

### 14.4.1 Upload a New Application Version

To upload a new version of the application code, you can do this by clicking on the *Upload and Deploy* button in the environment's dashboard:

![Upload and Deploy](/assets/aws-certified-developer-associate/eb_upload_and_deploy.png "Upload and Deploy")

### 14.4.2 Creating and Managing Multiple Environments

Go under your application where you can see all the environments that you have created:

![Manage Environments](/assets/aws-certified-developer-associate/eb_manage_environments.png "Manage Environments")

You can also create a new environment from here by clicking on the *Create New Environment* button. For example, we can add an environment for production:

![Create New Production Environment](/assets/aws-certified-developer-associate/eb_create_new_production_environment.png "Create New Production Environment")

The configurations can be the same as for the development environment in [14.4 Creating an Elastic Beanstalk Environment](#144-creating-an-elastic-beanstalk-environment) but, for example, we can change the presets to be high availability:

![High Availability Presets](/assets/aws-certified-developer-associate/eb_high_availability_presets.png "High Availability Presets")

And also change other optional configurations. For example, a **VPC**:

![VPC Configuration](/assets/aws-certified-developer-associate/eb_vpc_configuration.png "VPC Configuration")

And the **subnets** in which we want instances to be launched:

![Subnets Configuration](/assets/aws-certified-developer-associate/eb_subnets_configuration.png "Subnets Configuration")

In the configuration in the image above, you can also se it we want to use a public IP address or not. If you use a load balancer, we can avoid using a public IP address.

We can also specify if you want a **database**, which will be tight to the lifecycle of the environment. So, if we delete the environment, the database will be deleted as well.

![Database Configuration](/assets/aws-certified-developer-associate/eb_database_configuration.png "Database Configuration")

We can also change **EC2 instances settings** like the root volume or security group. Same for the **ASG** (e.g., capacity, scaling triggers, etc.) and **load balancer** (e.g., type, listeners, etc.), which can also be shared across multiple environments.

There are also the **other options** to configure email notifications, **rolling updates and deployments**, and other monitoring and logging configurations.

After finishing the configuration, we can create the environment and see it in the console, along with the other environments:

![Production Environment Created](/assets/aws-certified-developer-associate/eb_production_environment_created.png "Production Environment Created")